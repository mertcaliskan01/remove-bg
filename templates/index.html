<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Background Changer</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <h1>Background Changer</h1>
      <p>Upload your image and change its background!</p>

      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div class="alert alert-{{ category }}" id="flash-message">
        {{ message }}
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <form action="/upload" method="post" enctype="multipart/form-data">
        <div class="upload-container">
          <label for="file" class="upload-label">
            <div class="upload-icon">üìÅ</div>
            <span>Select Image</span>
          </label>
          <input
            type="file"
            id="file"
            name="file"
            accept=".jpg,.jpeg,.png"
            required
          />
          <div id="file-name" class="file-name">No file selected</div>
        </div>

        <div class="background-selection">
          <h3>Select Background Color</h3>

          <!-- Custom Color Input -->
          <div class="custom-color-section">
            <label for="custom-color">Custom Color (#05339C):</label>
            <input
              type="color"
              id="custom-color"
              name="custom-color"
              value="#05339C"
            />
          </div>

          <div class="color-grid">
            <!-- Custom Color Option -->
            <div class="color-option">
              <input
                type="radio"
                id="bg_custom"
                name="background"
                value="custom"
              />
              <label for="bg_custom" class="color-label">
                <div
                  id="custom-preview"
                  class="color-preview"
                  style="background-color: #05339c"
                ></div>
                <span>Custom Color</span>
              </label>
            </div>

            {% for key, value in backgroundColors.items() %}
            <div class="color-option">
              <input type="radio" id="bg{{ key }}" name="background" value="{{
              key }}" {% if key == '1' %}checked{% endif %}>
              <label for="bg{{ key }}" class="color-label">
                {% if 'gradient' in value %}
                <div
                  class="color-preview gradient-{{ value['gradient'] }}"
                ></div>
                {% elif 'color' in value and value['color'] is not none %}
                <div
                  class="color-preview"
                  style="background-color: rgb({{ value['color'][0] }}, {{ value['color'][1] }}, {{ value['color'][2] }});"
                ></div>
                {% else %}
                <div class="color-preview transparent"></div>
                {% endif %}
                <span>{{ value['name'] }}</span>
              </label>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="output-settings">
          <h3>Output Settings</h3>
          <div class="output-options">
            <label for="output-type">File Format:</label>
            <select id="output-type" name="output-type">
              <option value="png">PNG (Supports transparency)</option>
              <option value="jpg">JPG (Smaller file size)</option>
            </select>
          </div>
        </div>

        <button type="submit" class="submit-btn">Change Background</button>
      </form>
    </div>

    <script>
      // Custom color handling
      const customColorInput = document.getElementById("custom-color");
      const customPreview = document.getElementById("custom-preview");
      const customRadio = document.getElementById("bg_custom");

      customColorInput.addEventListener("change", function () {
        customPreview.style.backgroundColor = this.value;
        // Don't change radio value, keep it as 'custom'
      });

      customRadio.addEventListener("change", function () {
        if (this.checked) {
          // Keep radio value as 'custom', don't change it
          customPreview.style.backgroundColor = customColorInput.value;
        }
      });

      // File name display
      document.getElementById("file").addEventListener("change", function (e) {
        var fileName = e.target.files[0]
          ? e.target.files[0].name
          : "No file selected";
        document.getElementById("file-name").textContent = fileName;
      });
    </script>
  </body>
</html>
